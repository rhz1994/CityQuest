CREATE DATABASE CityQuest;

USE CityQuest;

-- Skapar tabell för städer
CREATE TABLE cities (
    cityId INT NOT NULL AUTO_INCREMENT,
    cityName VARCHAR(100) NOT NULL UNIQUE,
    cityDescription TEXT NOT NULL,
    latitude DECIMAL(9, 6) NOT NULL,
    longitude DECIMAL(9, 6) NOT NULL,
    PRIMARY KEY (cityId)
);

-- Skapar tabell för platser
CREATE TABLE locations (
    locationId INT NOT NULL AUTO_INCREMENT,
    locationName VARCHAR(100) NOT NULL,
    latitude DECIMAL(9, 6) NOT NULL,
    longitude DECIMAL(9, 6) NOT NULL,
    cityId INT,
    PRIMARY KEY (locationId),
    FOREIGN KEY (cityId) REFERENCES cities(cityId) ON DELETE CASCADE
);

-- Skapar tabell för quests
CREATE TABLE quests (
    questId INT NOT NULL AUTO_INCREMENT,
    questName VARCHAR(100) NOT NULL,
    questDescription TEXT NOT NULL,
    cityId INT,
    PRIMARY KEY (questId),
    FOREIGN KEY (cityId) REFERENCES cities(cityId) ON DELETE CASCADE
);

-- Skapar tabell för ledtrådar
CREATE TABLE clues (
    clueId INT NOT NULL AUTO_INCREMENT,
    clueName VARCHAR(100) NOT NULL,
    clueDescription TEXT,
    locationId INT,
    questId INT,
    PRIMARY KEY (clueId),
    FOREIGN KEY (locationId) REFERENCES locations(locationId) ON DELETE CASCADE ,
    FOREIGN KEY (questId) REFERENCES quests(questId) ON DELETE CASCADE
);

-- Skapar tabell för pussel
CREATE TABLE puzzles (
    puzzleId INT NOT NULL AUTO_INCREMENT,
    puzzleName VARCHAR(100) NOT NULL,
    puzzleDescription TEXT NOT NULL,
    clueId INT,
    PRIMARY KEY (puzzleId),
    FOREIGN KEY (clueId) REFERENCES clues(clueId) ON DELETE CASCADE
);

-- Skapar tabell för användare
CREATE TABLE users (
    userId INT NOT NULL AUTO_INCREMENT,
    userName VARCHAR(100) NOT NULL,
    userEmail VARCHAR(100) NOT NULL UNIQUE,
    PRIMARY KEY (userId)
);

-- Skapar tabell för användarens framsteg i quests
CREATE TABLE userProgress (
    userProgressId INT NOT NULL AUTO_INCREMENT,
    userId INT,
    questId INT,
    progress TINYINT UNSIGNED,
    timeLeft INT,
    PRIMARY KEY (userProgressId),
    FOREIGN KEY (questId) REFERENCES quests(questId) ON DELETE CASCADE ,
    FOREIGN KEY (userId) REFERENCES users(userId) ON DELETE CASCADE
);

-- Skapar tabell för belöningar
CREATE TABLE rewards (
    rewardId INT NOT NULL AUTO_INCREMENT,
    rewardName VARCHAR(100) NOT NULL,
    rewardDescription TEXT,
    rewardType VARCHAR(50),
    rewardValue INT,
    questId INT,
    PRIMARY KEY (rewardId),
    FOREIGN KEY (questId) REFERENCES quests(questId) ON DELETE CASCADE
);

-- Skapar tabell för användarens belöningar
CREATE TABLE user_rewards (
    userRewardId INT NOT NULL AUTO_INCREMENT,
    userId INT,
    rewardId INT,
    dateReceived DATETIME,
    isClaimed BOOLEAN DEFAULT FALSE,
    PRIMARY KEY (userRewardId),
    FOREIGN KEY (userId) REFERENCES users(userId) ON DELETE CASCADE ,
    FOREIGN KEY (rewardId) REFERENCES rewards(rewardId) ON DELETE SET NULL
);

-- Infogar en stad
INSERT INTO cities (cityName, cityDescription, latitude, longitude)
VALUES ('Gothenburg', 'A city located on the west coast of Sweden, known for its maritime history and beautiful parks.', 57.7089, 11.9746);

-- Infogar platser
INSERT INTO locations (locationName, latitude, longitude, cityId)
VALUES
('Liseberg', 57.7058, 11.9674, 1),
('Art Museum Of Gothenburg', 57.7055, 11.9672, 1),
('Avenyn', 57.7032, 11.9743, 1);

-- Infogar ett quest
INSERT INTO quests (questName, questDescription, cityId)
VALUES ('The Gothenburg Treasure Hunt', 'Solve the mystery and discover the treasure hidden around Gothenburg. You will need to visit several landmarks to find clues.', 1);

-- Infogar ledtrådar
INSERT INTO clues (clueName, clueDescription, locationId, questId)
VALUES
('Clue 1', 'Look for the hidden symbol above the door at Feskekörka.', 1, 1),
('Clue 2', 'Search near the entrance of Liseberg for a hidden number.', 2, 1),
('Clue 3', 'Look for a painting depicting the sea in Göteborgs Konstmuseum.', 3, 1),
('Clue 4', 'Walk down Avenyn and look for the bronze plaque with the mysterious symbol.', 3, 1);

-- Infogar ett pussel kopplat till en ledtråd
INSERT INTO puzzles (puzzleName, puzzleDescription, clueId)
VALUES ('Cipher Puzzle', 'Decode the ancient text found on the monument.', 1);

-- Infogar användare
INSERT INTO users (userName, userEmail)
VALUES ('Alice', 'alice@example.com'),
       ('Bob', 'bob@example.com');

-- Infogar användarens framsteg
INSERT INTO userProgress (userId, questId, progress, timeLeft)
VALUES (1, 1, 0.0, 180),
       (2, 1, 25.0, 150);

-- Infogar belöningar
INSERT INTO rewards (rewardName, rewardDescription, rewardType, rewardValue, questId)
VALUES ('Gold Medal', 'Awarded for completing the Gothenburg Treasure Hunt.', 'Physical', 100, 1),
       ('Extra Clue', 'Extra clue that helps you find the treasure faster.', 'Virtual', 0, 1);

-- Infogar användarens belöningar
INSERT INTO user_rewards (userId, rewardId, dateReceived, isClaimed)
VALUES (1, 1, NOW(), FALSE),
       (2, 2, NOW(), TRUE);

-- Kontrollera att allting finns i databasen
SHOW TABLES;
SELECT * FROM locations;
SELECT * FROM cities;
SELECT * FROM quests;
SELECT * FROM clues;
SELECT * FROM puzzles;
SELECT * FROM puzzles;

SELECT questName FROM quests;

SELECT * FROM users;
SELECT * FROM userProgress;

SELECT quests.*, cities.cityName
FROM quests
JOIN cities ON cities.cityId = quests.cityId
WHERE cities.cityName = 'Gothenburg';

SELECT cities.*, quests.questId, quests.questName
      FROM cities
      JOIN quests ON cities.cityId = quests.cityId
      WHERE cities.cityName = 'Gothenburg';

SELECT * FROM clues WHERE questId = 1;

SELECT * FROM clues WHERE clueId = 1;
